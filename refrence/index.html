<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Plinko Game</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
</head>
<body>
  <script>
    // Matter.js aliases
    const { Engine, Render, Runner, World, Bodies, Body, Events } = Matter;

    let engine, world;
    let pegs = [];
    let balls = [];
    let ground;

    function setup() {
      createCanvas(600, 800);

      // Initialize Matter.js engine and world
      engine = Engine.create();
      world = engine.world;

      // Create pegs
      const cols = 10;
      const rows = 10;
      const spacing = width / cols;

      for (let j = 0; j < rows; j++) {
        for (let i = 0; i < cols; i++) {
          const x = i * spacing + spacing / 2;
          const y = j * spacing + spacing / 2;
          if (j % 2 === 0) {
            pegs.push(new Peg(x, y));
          } else {
            pegs.push(new Peg(x + spacing / 2, y));
          }
        }
      }

      // Create ground
      ground = Bodies.rectangle(width / 2, height + 50, width, 100, {
        isStatic: true,
      });
      World.add(world, ground);

      // Run the engine
      Engine.run(engine);
    }

    function draw() {
      background(50);

      // Draw pegs
      for (let peg of pegs) {
        peg.show();
      }

      // Draw balls
      for (let ball of balls) {
        ball.show();
      }

      // Draw ground
      fill(200);
      rectMode(CENTER);
      rect(ground.position.x, ground.position.y, width, 100);
    }

    function mousePressed() {
      // Add a new ball at mouse position
      balls.push(new Ball(mouseX, 50));
    }

    // Peg class
    class Peg {
      constructor(x, y) {
        this.body = Bodies.circle(x, y, 10, { isStatic: true });
        World.add(world, this.body);
      }

      show() {
        const pos = this.body.position;
        fill(255);
        noStroke();
        ellipse(pos.x, pos.y, 20);
      }
    }

    // Ball class
    class Ball {
      constructor(x, y) {
        this.body = Bodies.circle(x, y, 15, { restitution: 0.7 });
        World.add(world, this.body);
      }

      show() {
        const pos = this.body.position;
        fill(200, 0, 200);
        noStroke();
        ellipse(pos.x, pos.y, 30);
      }
    }
  </script>
</body>
</html>
